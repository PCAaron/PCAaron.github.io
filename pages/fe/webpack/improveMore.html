<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack的进阶用法(二) | Web全栈技术笔记</title>
    <meta name="description" content="Web技术笔记，记录前端的进阶之路">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.d20cb8b9.css" as="style"><link rel="preload" href="/assets/js/app.2c921ca0.js" as="script"><link rel="preload" href="/assets/js/2.29093f4e.js" as="script"><link rel="preload" href="/assets/js/48.ba57127f.js" as="script"><link rel="prefetch" href="/assets/js/10.e7261647.js"><link rel="prefetch" href="/assets/js/11.3acb9245.js"><link rel="prefetch" href="/assets/js/12.30fa2830.js"><link rel="prefetch" href="/assets/js/13.f7f5633c.js"><link rel="prefetch" href="/assets/js/14.077d15bd.js"><link rel="prefetch" href="/assets/js/15.ca4c6dcf.js"><link rel="prefetch" href="/assets/js/16.33c76806.js"><link rel="prefetch" href="/assets/js/17.c1d108fb.js"><link rel="prefetch" href="/assets/js/18.f2c74917.js"><link rel="prefetch" href="/assets/js/19.4d0677d6.js"><link rel="prefetch" href="/assets/js/20.05a49d49.js"><link rel="prefetch" href="/assets/js/21.303ca718.js"><link rel="prefetch" href="/assets/js/22.dd8c450d.js"><link rel="prefetch" href="/assets/js/23.c436f815.js"><link rel="prefetch" href="/assets/js/24.5817cae1.js"><link rel="prefetch" href="/assets/js/25.7640084e.js"><link rel="prefetch" href="/assets/js/26.6981ceda.js"><link rel="prefetch" href="/assets/js/27.d96b5401.js"><link rel="prefetch" href="/assets/js/28.7e5507ca.js"><link rel="prefetch" href="/assets/js/29.0486ec9e.js"><link rel="prefetch" href="/assets/js/3.5ee6df4b.js"><link rel="prefetch" href="/assets/js/30.0705fdc2.js"><link rel="prefetch" href="/assets/js/31.3e20c412.js"><link rel="prefetch" href="/assets/js/32.40154bdb.js"><link rel="prefetch" href="/assets/js/33.54042f7d.js"><link rel="prefetch" href="/assets/js/34.992a68b5.js"><link rel="prefetch" href="/assets/js/35.fe5d31f8.js"><link rel="prefetch" href="/assets/js/36.20985163.js"><link rel="prefetch" href="/assets/js/37.7e0e1be1.js"><link rel="prefetch" href="/assets/js/38.c81dfd87.js"><link rel="prefetch" href="/assets/js/39.799324c8.js"><link rel="prefetch" href="/assets/js/4.505f2474.js"><link rel="prefetch" href="/assets/js/40.4a8ca097.js"><link rel="prefetch" href="/assets/js/41.3bdce235.js"><link rel="prefetch" href="/assets/js/42.13fe7b3a.js"><link rel="prefetch" href="/assets/js/43.b51c1b2e.js"><link rel="prefetch" href="/assets/js/44.408a421f.js"><link rel="prefetch" href="/assets/js/45.63e44fa3.js"><link rel="prefetch" href="/assets/js/46.409b4b6a.js"><link rel="prefetch" href="/assets/js/47.e253242d.js"><link rel="prefetch" href="/assets/js/49.7637631e.js"><link rel="prefetch" href="/assets/js/5.5326fad8.js"><link rel="prefetch" href="/assets/js/50.5c4dae5f.js"><link rel="prefetch" href="/assets/js/51.5ced2ccf.js"><link rel="prefetch" href="/assets/js/52.0447cb17.js"><link rel="prefetch" href="/assets/js/53.bb22200a.js"><link rel="prefetch" href="/assets/js/54.cbb62dbb.js"><link rel="prefetch" href="/assets/js/55.951cd720.js"><link rel="prefetch" href="/assets/js/56.3026c904.js"><link rel="prefetch" href="/assets/js/57.925dacf9.js"><link rel="prefetch" href="/assets/js/58.32a50715.js"><link rel="prefetch" href="/assets/js/59.f1f9cb40.js"><link rel="prefetch" href="/assets/js/6.9c6dd834.js"><link rel="prefetch" href="/assets/js/60.be19c9ef.js"><link rel="prefetch" href="/assets/js/61.c84c312a.js"><link rel="prefetch" href="/assets/js/62.b2e36c2d.js"><link rel="prefetch" href="/assets/js/7.a22cca04.js"><link rel="prefetch" href="/assets/js/8.34ea0bd8.js"><link rel="prefetch" href="/assets/js/9.224ad97b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d20cb8b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.ico" alt="Web全栈技术笔记" class="logo"> <span class="site-name can-hide">Web全栈技术笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fe/vue/" class="nav-link">Vue.js实战</a></li><li class="dropdown-item"><!----> <a href="/pages/fe/webpack/" class="nav-link router-link-active">玩转webpack4.0</a></li><li class="dropdown-item"><!----> <a href="/pages/fe/chrome/" class="nav-link">浏览器工作原理与实战</a></li><li class="dropdown-item"><!----> <a href="/pages/fe/block/introduce.html" class="nav-link">区块链开发入门</a></li><li class="dropdown-item"><!----> <a href="/pages/fe/git/" class="nav-link">Git命令大全</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/PCAaron/PCAaron.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/aaron-pan/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/fe/vue/" class="nav-link">Vue.js实战</a></li><li class="dropdown-item"><!----> <a href="/pages/fe/webpack/" class="nav-link router-link-active">玩转webpack4.0</a></li><li class="dropdown-item"><!----> <a href="/pages/fe/chrome/" class="nav-link">浏览器工作原理与实战</a></li><li class="dropdown-item"><!----> <a href="/pages/fe/block/introduce.html" class="nav-link">区块链开发入门</a></li><li class="dropdown-item"><!----> <a href="/pages/fe/git/" class="nav-link">Git命令大全</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/PCAaron/PCAaron.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.cnblogs.com/aaron-pan/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客园
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack导读</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fe/webpack/" class="sidebar-link">Webpack导读</a></li><li><a href="/pages/fe/webpack/history.html" class="sidebar-link">webpack与构建发展史</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>webpack基础篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fe/webpack/basic.html" class="sidebar-link">webpack的基本用法：核心概念</a></li><li><a href="/pages/fe/webpack/basicUsage.html" class="sidebar-link">webpack的基本用法：常用配置</a></li><li><a href="/pages/fe/webpack/improve.html" class="sidebar-link">webpack的进阶用法（一）</a></li><li><a href="/pages/fe/webpack/improveMore.html" class="active sidebar-link">webpack的进阶用法（二）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/fe/webpack/improveMore.html#摇树优化：tree-shaking" class="sidebar-link">摇树优化：Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/pages/fe/webpack/improveMore.html#作用域提升：scope-hoisting" class="sidebar-link">作用域提升：Scope Hoisting</a></li><li class="sidebar-sub-header"><a href="/pages/fe/webpack/improveMore.html#代码分割和动态import" class="sidebar-link">代码分割和动态import</a></li><li class="sidebar-sub-header"><a href="/pages/fe/webpack/improveMore.html#javascript语法规范：eslint" class="sidebar-link">JavaScript语法规范：ESLint</a></li><li class="sidebar-sub-header"><a href="/pages/fe/webpack/improveMore.html#打包组件和基础库" class="sidebar-link">打包组件和基础库</a></li><li class="sidebar-sub-header"><a href="/pages/fe/webpack/improveMore.html#优化构建命令行日志" class="sidebar-link">优化构建命令行日志</a></li><li class="sidebar-sub-header"><a href="/pages/fe/webpack/improveMore.html#构建异常和中断处理" class="sidebar-link">构建异常和中断处理</a></li><li class="sidebar-sub-header"><a href="/pages/fe/webpack/improveMore.html#推荐阅读" class="sidebar-link">推荐阅读</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack进阶篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fe/webpack/config.html" class="sidebar-link">可维护的webpack构建配置</a></li><li><a href="/pages/fe/webpack/optimize.html" class="sidebar-link">webpack构建速度及体积优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack原理篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fe/webpack/principle.html" class="sidebar-link">运行webpack发生了什么？</a></li><li><a href="/pages/fe/webpack/nature.html" class="sidebar-link">webpack插件机制</a></li><li><a href="/pages/fe/webpack/flow.html" class="sidebar-link">webpack编译流程分析</a></li><li><a href="/pages/fe/webpack/webpack.html" class="sidebar-link">迷你webpack的实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编写loader和plugin</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fe/webpack/loader.html" class="sidebar-link">编写一个loader</a></li><li><a href="/pages/fe/webpack/plugin.html" class="sidebar-link">编写一个plugin</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack的进阶用法-二"><a href="#webpack的进阶用法-二" class="header-anchor">#</a> webpack的进阶用法(二)</h1> <h2 id="摇树优化：tree-shaking"><a href="#摇树优化：tree-shaking" class="header-anchor">#</a> 摇树优化：Tree Shaking</h2> <p>webpack借鉴了rollup构建工具，从2.0就实现支持tree shaking，其中，到webpack4.0后
通过开启mode:'production'即默认开启。</p> <h3 id="tree-shaking原理"><a href="#tree-shaking原理" class="header-anchor">#</a> tree shaking原理</h3> <p>DCE(Dead code elimination)，即死码消除，编译器原理中，死码消除（Dead code elimination）是一种编译最优化技术，它的用途是移除对程序运行结果没有任何影响的代码。</p> <p>其中死码的特点：</p> <ul><li>代码不会被执行，不可到达</li> <li>代码执行的结果不会被用到</li> <li>代码知会影响死变量(只读不写)</li></ul> <p>其中，tree shaking就是借鉴了这个原理，利用了ES6模块的特点：</p> <ul><li>其中import、exports只能作为模块顶层的语句出现</li> <li>import 的模块名只能是字符串常量</li> <li>import 的模块名是常量不能进行修改</li></ul> <p>tree shaking就是利用ES6的这一特点，本质就是对静态的模块代码进行分析，所以需要
在构建过程中确定哪些模块的代码能利用到，哪些模块不需要进行区分。通过标识不需要
使用的代码在uglify阶段删除无用代码。</p> <h3 id="tree-shaking概念和使用"><a href="#tree-shaking概念和使用" class="header-anchor">#</a> tree shaking概念和使用</h3> <p>顾名思义，tree shaking摇树优化其中就是类似于摇晃树，过程会使一些枯枝枯叶掉落。</p> <p>tree shaking就是通过在构建过程，如果一个模块存在多个方法，如果只有其中的某个方法
使用到，则将一些没有引用到的代码在这个打包过程移除，只把用到的方法打入bundle中。</p> <p>通过开启mode:'production'即可。其中，只支持ES6的语法，commonjs的方式(即require方式)不支持使用。</p> <h2 id="作用域提升：scope-hoisting"><a href="#作用域提升：scope-hoisting" class="header-anchor">#</a> 作用域提升：Scope Hoisting</h2> <h3 id="webpack的模块机制"><a href="#webpack的模块机制" class="header-anchor">#</a> webpack的模块机制</h3> <p><img src="/public/improveWebpack.jpg" alt="webpack的模块机制"></p> <p>我们可以了解到，webpack打包出来的是一个IIFE(立即调用函数表达式，也是常说的匿名闭包)，
其中，modules数组的每一项是一个模块初始化函数，通过__webpack_require的方式来加载模块，
返回module.exports，并且通过__webpack_require_(0)的方式启动程序。</p> <h3 id="scope-hoisting原理及使用"><a href="#scope-hoisting原理及使用" class="header-anchor">#</a> scope hoisting原理及使用</h3> <p>在没有开启scope hoisting前，这样构建后的代码会存在大量的闭包代码。</p> <p><img src="/webpack/improveScope.jpg" alt="未启用scope hoisting前"></p> <p>由于模块依赖，通过webpack打包后会转换成自执行匿名函数，这样，
由于大量函数闭包包裹代码，会导致体积增大(模块越多就越明显)；运行代码
时创建的函数作用域变多，导致内存开销也变大。</p> <p>其中，scope hoisting的概念也是借鉴了rollup的构建原理并在webpak3.0时候引入，
其原理就是<strong>将所有模块的代码按照引入顺序放到一个函数作用域里，然后适当的重命名
一些变量以防止变量名冲突</strong>。这样就可以实现减少函数声明代码和内存花销。</p> <p>在webpack4中，也只需要把<strong>mode状态调整为production即默认开启，其中，需要注意的是
只支持ES6语法</strong>，commonjs的动态引入还不支持。</p> <p>而webpack3中则需要配置插件<code>webpack.optimize.ModuleConcatenationPlugin</code>。</p> <h2 id="代码分割和动态import"><a href="#代码分割和动态import" class="header-anchor">#</a> 代码分割和动态import</h2> <p>对于一些大型的web应用，将代码打包到一个chunk是不够有效的，会导致加载的文件过大，导致页面加载慢，体验差等。所以需要通过代码分割成多个chunks，当代码运行到需要时候才进行加载。</p> <p>一般通过抽离相同代码到一个共享块或者脚本懒加载使得初始下载的代码更小。<br>
前面我们已经说到通过SplitChunksPlugin来进行通用的代码抽离，而懒加载脚本的方式我们需要条件判断等方式通过ES6的动态import的方式实现。<br>
其中，动态import目前没有原生支持，需要babel转换。安装依赖并配置.babelrc</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>syntax<span class="token operator">-</span>dynamic<span class="token operator">-</span><span class="token keyword">import</span> <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>配置.babelrc</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
     <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过动态import，点击事件加载脚本，demo:<br> <img src="/public/improveDemo.jpg" alt="动态import"></p> <h2 id="javascript语法规范：eslint"><a href="#javascript语法规范：eslint" class="header-anchor">#</a> JavaScript语法规范：ESLint</h2> <p>ESLint 是一个插件化并且可配置的 JavaScript 语法规则和代码风格的检查工具，能够及早的发现代码错误并且帮助保持团队代码风格的统一。</p> <p>其中比较有名的ESLint规范实践有：<a href="https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb" target="_blank" rel="noopener noreferrer">eslint-config-airbnb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/AlloyTeam/eslint-config-alloy" target="_blank" rel="noopener noreferrer">eslint-config-alloy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/feflow/eslint-config-ivweb" target="_blank" rel="noopener noreferrer">eslint-config-ivweb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>等。</p> <p>可通过基于eslint:recommend配置对规范进行改进。</p> <h3 id="eslint规则"><a href="#eslint规则" class="header-anchor">#</a> eslint规则</h3> <table><thead><tr><th>规则名称</th> <th>错误级别</th> <th>说明</th></tr></thead> <tbody><tr><td>for-direction</td> <td>error</td> <td>for循环的方向要求必须正确</td></tr> <tr><td>getter-return</td> <td>error</td> <td>getter必须有返回值，并且禁止返回值为undefined，比如return</td></tr> <tr><td>no-await-in-loop</td> <td>off</td> <td>允许在循环里面使用await</td></tr> <tr><td>no-console</td> <td>off</td> <td>允许在代码里面是有console</td></tr> <tr><td>array-callback-return</td> <td>error</td> <td>对于数据相关操作函数比如reduce、map、filter等，callback必须有return</td></tr> <tr><td>accessor-pairs</td> <td>warn</td> <td>在字符串里面出现(和)进行警告</td></tr></tbody></table> <p>更多规则可参考：<a href="https://eslint.org/docs/rules/" target="_blank" rel="noopener noreferrer">https://eslint.org/docs/rules/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="eslint落地"><a href="#eslint落地" class="header-anchor">#</a> ESLint落地</h3> <p>具体ESLint落地的实施可以有两个方案，通过<strong>CI/CD(持续集成/持续交付)系统集成</strong>或者和<strong>webpack等构建工具集成</strong>。</p> <h4 id="eslint与ci-cd系统集成"><a href="#eslint与ci-cd系统集成" class="header-anchor">#</a> ESLint与CI/CD系统集成</h4> <p>gitlab集成lint的常用做法：</p> <p><img src="/public/improveLint.jpg" alt="CI/CD集成"></p> <p>本地开发时可以通过增加precommit钩子实现开发环境的检查。<br>
安装husky并配置package</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i husky <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token string">&quot;precommit&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;lint-staged&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">&quot;lint-staged&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token string">&quot;linters&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token string">&quot;*.js&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;eslint-fix&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;git add&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="webpack与eslint集成"><a href="#webpack与eslint集成" class="header-anchor">#</a> webpack与ESLint集成</h4> <p>通过使用eslint-loader，构建时检查JS规范。这种做法比较适合新项目的使用。因为该方案会默认在开发构建时对所有文件进行规范的检查。</p> <p>安装基于react的eslint的依赖包,<a href="https://github.com/AlloyTeam/eslint-config-alloy" target="_blank" rel="noopener noreferrer">eslint-config-alloy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev eslint babel<span class="token operator">-</span>eslint eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>react eslint<span class="token operator">-</span>config<span class="token operator">-</span>alloy
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i eslint<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>配置.eslintrc.js
parser使用babel-eslint，并继承eslint-config-airbnb</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i eslint<span class="token operator">-</span>config<span class="token operator">-</span>airbnb <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;parser&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;babel-eslint&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;extends&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">'alloy'</span><span class="token punctuation">,</span>
        <span class="token string">'alloy/react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;rules&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;indent&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;env&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">// 当前生效环境</span>
        <span class="token string">&quot;browser&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string">&quot;node&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="打包组件和基础库"><a href="#打包组件和基础库" class="header-anchor">#</a> 打包组件和基础库</h2> <p>webpack不仅可以用来打包应用，也可以用来打包js库来方便我们的日常开发。</p> <h3 id="实现大整数加法库的打包demo"><a href="#实现大整数加法库的打包demo" class="header-anchor">#</a> 实现大整数加法库的打包demo</h3> <p>1、确定打包需求：</p> <ul><li>需要打包压缩版和非压缩版本</li> <li>支持script标签/AMD/CJS/ESM模块引入</li></ul> <p>2、js库的目录结构</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">.</span>
├── dist   <span class="token comment">// 打包输出文件夹</span>
<span class="token operator">|</span>   ├── webpack<span class="token operator">-</span>larger<span class="token operator">-</span>number<span class="token punctuation">.</span>js    <span class="token comment">// 未压缩版输出文件</span>
<span class="token operator">|</span>   └── webpack<span class="token operator">-</span>larger<span class="token operator">-</span>number<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js <span class="token comment">//压缩版</span>
├── <span class="token keyword">package</span><span class="token punctuation">.</span>json <span class="token comment">// 依赖包配置说明</span>
├── webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js  <span class="token comment">// 打包配置</span>
├── demo<span class="token punctuation">.</span>js     <span class="token comment">// </span>
├── src         <span class="token comment">// 源码</span>
     └── demo<span class="token punctuation">.</span>js      
</code></pre></div><p>3、配置webpack</p> <p>相对于一般打包应用，我们需要配置output参数实现将库暴露出去，其中，library可以指定库的名称</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
        library<span class="token punctuation">:</span> <span class="token string">&quot;WebpackLargeNumber&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 指定库的全局变量</span>
        libraryExport<span class="token punctuation">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> 
        libraryTarget<span class="token punctuation">:</span> <span class="token string">&quot;umd&quot;</span> <span class="token comment">// 支持库引入的方式，默认以libary指定的变量名</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>更多详情参数可参考：<a href="https://www.webpackjs.com/configuration/output/#output-library" target="_blank" rel="noopener noreferrer">https://www.webpackjs.com/configuration/output/#output-library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>配置webpack，指定.min文件压缩</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports  <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        minimize<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认为true，压缩js代码</span>
        minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// terser-webpack-plugin支持es6语法压缩</span>
                include<span class="token punctuation">:</span> <span class="token regex">/\.min\.js$/</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

</code></pre></div><p>更多optimization可参考：<a href="https://webpack.docschina.org/configuration/optimization/" target="_blank" rel="noopener noreferrer">https://webpack.docschina.org/configuration/optimization/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
然后设置入口文件，对于开发环境则引入未打包的js库，而生产环境则使用压缩后的库</p> <p>4、设置package的入口文件并设置对应环境变量引入不同的库。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// package.js</span>
 <span class="token string">&quot;main&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;demo.js&quot;</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// demo.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">requier</span><span class="token punctuation">(</span><span class="token string">'./dist/webpack-large-number.min.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/webpack-large-number'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后，我们也可通过npm publish发布到npm上(ps：需要npm账号),然后我们就可以通过npm下载依赖包
并且通过默认的导出名WebpackLargeNumber.add('99','2')方式直接使用函数。</p> <p>大整数加法demo：<a href="https://github.com/PCAaron/blogCode/tree/master/webpack/webpack-large-number" target="_blank" rel="noopener noreferrer">https://github.com/PCAaron/blogCode/tree/master/webpack/webpack-large-number<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="优化构建命令行日志"><a href="#优化构建命令行日志" class="header-anchor">#</a> 优化构建命令行日志</h2> <p>使用webpack打包的时候，默认会将所有的打包构建信息打印出来，而stats选项则可以很好获取部分需要的bundle信息。</p> <p>常见的stats值：</p> <table><thead><tr><th>Preset</th> <th>Alternative</th> <th>Description</th></tr></thead> <tbody><tr><td>errors-only</td> <td>none</td> <td>只在发生错误时输出</td></tr> <tr><td>minimal</td> <td>none</td> <td>只在发生错误或有新的编译时输出</td></tr> <tr><td>none</td> <td>false</td> <td>没有输出</td></tr> <tr><td>normal</td> <td>true</td> <td>标准输出</td></tr> <tr><td>verbose</td> <td>none</td> <td>全部输出</td></tr></tbody></table> <p>配置webpack，其中，需要注意的是，对于webpack-dev-server，stats需要放到devServer中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> 
    stats<span class="token punctuation">:</span> <span class="token string">'errors-only'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过设置stats为errors-only，我们可以看到dev和build的日志成功的话也没有一些bundle信息，这是，我们可以借助friendly-errors-webpack-plugin对命令行的日志进行优化。</p> <p>安装<strong>friendly-errors-webpack-plugin</strong>并配置。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i friendly<span class="token operator">-</span>errors<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>配置webpack</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> FriendlyErrorsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'friendly-errors-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="构建异常和中断处理"><a href="#构建异常和中断处理" class="header-anchor">#</a> 构建异常和中断处理</h2> <p>如果打包时候存在一些构建异常和中断，需要捕获并做一些异常提示或者内容上报时候，我们可以通过compiler在每次构建结束后出发done的钩子实现异常的抓捕。</p> <p>其中，我们需要借助node的process.exit抛出异常，默认情况下，
process.exit抛出0表示成功，err为null；而非0则执行失败，
其中err为错误信息，code为对应的状态码。</p> <p>配置webpack</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">,</span> <span class="token parameter">stats</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>errors <span class="token operator">&amp;&amp;</span> stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>
                    process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'--watch'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'build err'</span><span class="token punctuation">)</span>
                    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="推荐阅读"><a href="#推荐阅读" class="header-anchor">#</a> 推荐阅读</h2> <p>代码demo：<a href="https://github.com/PCAaron/blogCode/tree/master/webpack/webpack-improveMore" target="_blank" rel="noopener noreferrer">https://github.com/PCAaron/blogCode/tree/master/webpack/webpack-improveMore<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Scope Hoisting优化Webpack输出:<a href="https://www.imweb.io/topic/5a43064fa192c3b460fce360" target="_blank" rel="noopener noreferrer">https://www.imweb.io/topic/5a43064fa192c3b460fce360<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/fe/webpack/improve.html" class="prev">webpack的进阶用法（一）</a></span> <span class="next"><a href="/pages/fe/webpack/config.html">可维护的webpack构建配置</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2c921ca0.js" defer></script><script src="/assets/js/2.29093f4e.js" defer></script><script src="/assets/js/48.ba57127f.js" defer></script>
  </body>
</html>
